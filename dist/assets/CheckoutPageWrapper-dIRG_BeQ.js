import{N as L,r as j,O as A,e as k,j as e,f as I,D as S,i as F,_ as N,R as C,S as O,s as q,A as M,n as R,L as P,P as T}from"./index-Ufe3u8P4.js";import{a as B,h as G,b as $}from"./orders-T5HsVQOZ.js";import{c as K,d as Q}from"./getPriceAfterDiscount-mGMBZI7i.js";import{g as z}from"./getSizeDetailsSIzeAndSide-oE1eJOVg.js";import{u as V}from"./useQueries-zEctxauR.js";import{n as Y}from"./no-address-F9_hSvsD.js";import{g as H,b as J,c as W,C as U}from"./CartPageSkeleton-gjFWHv5d.js";import{A as X}from"./AppEmpty-wz2TrwwE.js";var w=function(){return w=Object.assign||function(r){for(var t,c=1,a=arguments.length;c<a;c++){t=arguments[c];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},w.apply(this,arguments)},Z=function(r,t){var c={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(c[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(r);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(r,a[s])&&(c[a[s]]=r[a[s]]);return c},ee=L("PulseLoader","0% {transform: scale(1); opacity: 1} 45% {transform: scale(0.1); opacity: 0.7} 80% {transform: scale(1); opacity: 1}","pulse");function se(r){var t=r.loading,c=t===void 0?!0:t,a=r.color,s=a===void 0?"#000000":a,d=r.speedMultiplier,u=d===void 0?1:d,x=r.cssOverride,l=x===void 0?{}:x,p=r.size,n=p===void 0?15:p,o=r.margin,y=o===void 0?2:o,f=Z(r,["loading","color","speedMultiplier","cssOverride","size","margin"]),h=w({display:"inherit"},l),b=function(v){return{backgroundColor:s,width:A(n),height:A(n),margin:A(y),borderRadius:"100%",display:"inline-block",animation:"".concat(ee," ").concat(.75/u,"s ").concat(v*.12/u,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return c?j.createElement("span",w({style:h},f),j.createElement("span",{style:b(1)}),j.createElement("span",{style:b(2)}),j.createElement("span",{style:b(3)})):null}const re=({selectedAddress:r,setSelectedAddress:t,i:c,address:a})=>{var d,u,x,l,p;const{user:s}=k(n=>n.user);return e.jsx(e.Fragment,{children:s[a]&&e.jsxs("button",{onClick:()=>t(a),className:`flex items-start justify-start text-start flex-col gap-1 border-2  py-2 px-8 rounded-lg  transition-colors ${r===a?"border-primary":"hover:border-green-200 border-gray-100"}      
          `,children:[e.jsxs("span",{className:"text-lg font-500",children:["Address ",c+1]}),e.jsx("span",{children:(d=s[a])==null?void 0:d.landmark}),e.jsx("span",{children:(u=s[a])==null?void 0:u.address}),e.jsxs("span",{children:[(x=s[a])==null?void 0:x.state,", ",(l=s[a])==null?void 0:l.city]}),e.jsx("span",{children:(p=s[a])==null?void 0:p.pin_code})]})})},te=({totalAmount:r,totalItems:t,finalAmount:c,discountAmount:a,deliveryAddress:s,orderItems:d,isSomeItemOutOfStock:u})=>{const x=I(),[l,p]=j.useState({code:"",isCouponApplied:!1}),{state:n}=S(),{user:o}=k(i=>i.user),[y,f]=j.useState(!1),h="flex justify-between text-base sm:text-lg gap-6 min-w-max w-full",{mutate:b,isPending:v,data:g}=F({mutationFn:i=>B(i),onError:i=>{N.error(i)},onSuccess:i=>{p(m=>({...m,isCouponApplied:!0})),N.success("Coupon Applied Successfully, you saved ₹"+i.discount),C.event({category:"Coupon",action:`Applied coupon ${l}`})}}),_=async()=>{var i;if(y)return N.error("Processing your request");if(u)return O.fire({icon:"error",title:"Oops...",text:"Some items are out of stock! Please remove them and try again",confirmButtonText:"Go to Cart"}).then(m=>{m.isConfirmed&&x("/cart")});if(!(o.primaryaddress||o.secondaryaddress||o.thirdaddress))return O.fire({icon:"error",title:"Oops...",text:"Please add a delivery address",confirmButtonText:"Add Address"}).then(m=>{m.isConfirmed&&x("/account?tab=addresses")});f(!0);try{localStorage.removeItem("orderDetails"),q("orderDetails",{deliveryAddress:{...o[s],phoneNo:o.phoneNo,pinCode:(i=o[s])==null?void 0:i.pin_code},orderItems:d,from:n==null?void 0:n.from,coupon:{isCouponApplied:l.isCouponApplied,code:l.code,discount:(g==null?void 0:g.discount)||0}}),C.event({category:"Checkout",action:"Clicked on Proceed to Pay"});const m=await G(),E=await $(Math.max(1,c-(l.isCouponApplied?g.discount:0)).toFixed(2)),D={key:m,amount:E.order.amount,currency:"INR",name:"Java Sports",description:"",image:"java-sports.svg",order_id:E.order.id,callback_url:M.paymentVerification,prefill:{name:o.full_name,email:o.email,contact:o.phoneNo},notes:{address:"Razorpay Corporate Office"},theme:{color:"#121212"},modal:{ondismiss:function(){localStorage.removeItem("orderDetails"),f(!1),N.error("Payment Cancelled"),C.event({category:"Checkout",action:"Payment Cancelled"})}}};new window.Razorpay(D).open()}catch{N.error("Something went wrong")}finally{f(!1)}};return e.jsxs("div",{className:"shadow-md border border-gray-200 border-opacity-40 sticky xl:top-4 rounded-md px-4 py-5 sm:p-6 bg-white h-fit flex flex-col gap-3 text-gray-700 sm:min-w-96 min-h-80 justify-center",children:[e.jsx("span",{className:"uppercase text-xl font-600 text-black",children:"Price Details"}),e.jsx("hr",{}),e.jsxs("div",{className:h,children:[e.jsxs("span",{children:["Price (",t," items)"]}),e.jsxs("span",{children:["₹",r.toFixed(2)]})]}),e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"text-green-400 text-[17px]",children:[" - ₹",a]})]}),l.isCouponApplied&&e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Coupon"}),e.jsxs("span",{className:"text-green-400 text-[17px]",children:[" ","- ₹",g.discount]})]}),e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Delivery Charges"}),e.jsx("span",{className:"text-green-400 text-[17px]",children:"Free"})]}),e.jsx("hr",{}),e.jsxs("div",{className:h+" font-700",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["₹",(l.isCouponApplied?Math.max(1,c-g.discount):c).toFixed(2)]})]}),e.jsx("hr",{}),e.jsxs("span",{className:"text-sm text-grey-dark",children:["You will save ₹"," ",(a+(l.isCouponApplied?g.discount:0)).toFixed(2)," ","on this order"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("form",{onSubmit:i=>{var m;i.preventDefault(),l.code.trim()!==""&&b((m=l==null?void 0:l.code)==null?void 0:m.trim())},className:"flex flex-col xs:flex-row",children:[e.jsx("input",{className:"border rounded-t-md xs:rounded-l-md xs:rounded-tr-none py-2 flex-grow px-3 focus:outline-grey/2 text-gray-500 sm:text-lg",type:"text",placeholder:"Enter the Coupon code",value:l.code,onChange:i=>p({...l,code:i.target.value}),disabled:l.isCouponApplied||v}),e.jsx("button",{disabled:l.isCouponApplied||v||l.code.trim()==="",className:"bg-grey/1 font-500 px-6 py-1",children:l.isCouponApplied?"Applied":v?e.jsx(se,{size:8,color:"#121212"}):"Apply"})]}),e.jsx("button",{onClick:_,className:"bg-red-500 text-lg py-2 text-white rounded-[5px] font-500",children:y?"Processing...":"Proceed to Pay"})]})]})},ae=({item:r,response:t})=>{const{data:c,isLoading:a,isError:s}=t;if(a||s)return null;const d=z(c.product.sizes,r.size,r.side);return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 border p-3 rounded-md w-full",children:[e.jsx("div",{className:"h-full flex items-center justify-center bg-grey/1 rounded-lg p-2 object-contain object-center w-fit group",children:e.jsx("img",{src:c.product.images[0].url,alt:c.product.name,className:"w-52 object-contain object-center"})}),e.jsxs("div",{className:"flex flex-col gap-4 relative",children:[e.jsx("h1",{className:"text-xl font-[600]",children:c.product.name}),e.jsxs("div",{className:"flex flex-col gap-1 text-base sm:text-lg",children:[e.jsxs("span",{className:"text-primary text-xs sm:text-sm font-500",children:["Special Price"," "]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("span",{className:"text-neutral-black text-xl font-500",children:["₹",(K(d.basePrice,d.discountedPercent)*r.quantity).toFixed(2)]}),e.jsxs("span",{className:"text-[#999999] line-through",children:["₹",(Number(d.basePrice)*r.quantity).toFixed(2)]}),e.jsxs("span",{className:"text-[#00B553] font-500",children:[d.discountedPercent??0,"% off"]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex gap-2 sm:gap-6",children:[e.jsxs("div",{className:"font-[600] text-lg flex flex-col gap-2",children:[e.jsx("span",{children:"Quantity"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("span",{className:"px-4 py-1 border-2 border-[#E4E4E4] rounded-md font-500 text-black",children:r.quantity})})]}),r.size&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"h-[80%] w-[1.5px] bg-grey-light opacity-50 self-end hidden md:block"}),e.jsxs("div",{className:"flex flex-col gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-500 text-neutral-black text-lg",children:"Size"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("span",{className:"px-4 py-1 border-2 border-[#E4E4E4] rounded-md font-500 text-black",children:d.size})})]})]}),r.side&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"h-[80%] w-[1.5px] bg-grey-light opacity-50 self-end hidden md:block"}),e.jsxs("div",{className:"flex flex-col gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-500 text-neutral-black text-lg",children:"Side"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("span",{className:"px-4 py-1 border-2 border-[#E4E4E4] rounded-md font-500 text-black",children:d.side})})]})]}),r.color&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"h-[80%] w-[1.5px] bg-grey-light opacity-50 self-end hidden md:block"}),e.jsx("hr",{className:" bg-grey-light opacity-50 md:hidden"}),e.jsxs("div",{className:"font-[600] text-lg flex flex-col gap-2",children:[e.jsx("span",{children:"Color"}),e.jsx("div",{className:"flex gap-3",children:e.jsx("span",{className:"w-8 h-8 rounded-full border-[#E4E4E4] border-[2.5px]",style:{backgroundColor:r.color}})})]})]})]})]})]})},ne=()=>{var u,x,l,p;const r=I(),{user:t}=k(n=>n.user),[c,a]=j.useState("primaryaddress"),{state:s}=S(),d=V({queries:(u=s==null?void 0:s.orderItems)==null?void 0:u.map(n=>({queryKey:["product",n.product],queryFn:()=>Q(n.product)}))});return s||r("/cart"),e.jsx("div",{className:"bg-white py-10",children:e.jsxs("section",{className:"wrapper flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-5 justify-center card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl  font-700 font-Lato",children:"Logged in as"}),e.jsx("span",{className:"text-blue font-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsx("img",{src:((x=t==null?void 0:t.avatar)==null?void 0:x.url)||R,className:"w-12 h-12 rounded-full object-cover object-center"}),e.jsx(P,{to:"/account",className:"font-500 text-xl hover:underline",children:t==null?void 0:t.full_name})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{children:["Email: ",t==null?void 0:t.email]}),e.jsxs("span",{children:["Phone: ",t==null?void 0:t.phoneNo]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 justify-center card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl font-700 font-Lato",children:"Delivery Address"}),e.jsx(P,{to:"/account?tab=addresses",className:"text-blue font-500",children:"Edit"})]}),e.jsx("div",{className:"flex gap-3 flex-col lg:flex-row",children:["primaryaddress","secondaryaddress","thirdaddress"].map((n,o)=>e.jsx(re,{selectedAddress:c,setSelectedAddress:a,address:n,i:o},o))}),!(t.primaryaddress||t.secondaryaddress||t.thirdaddress)&&e.jsx(X,{btnText:"Add Address",text:"You have not added any address",to:"/account?tab=addresses&redirect=/checkout",state:s,img:Y})]}),d.every(n=>n.isSuccess)?e.jsxs("div",{className:"flex gap-6 flex-col xl:flex-row",children:[e.jsxs("div",{className:"flex flex-col flex-grow gap-4 card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl font-700 font-Lato",children:"Order Summery"}),(s==null?void 0:s.from)&&(s==null?void 0:s.from)!=="reorder"&&e.jsx(P,{to:s!=null&&s.from&&(s==null?void 0:s.from)==="product"?`/product/${(l=s==null?void 0:s.orderItems[0])==null?void 0:l.id}`:"/cart",className:"text-blue font-500 text-lg",children:"Edit"})]}),e.jsxs("div",{className:"flex gap-5 flex-col",children:[s==null?void 0:s.orderItems.map((n,o)=>e.jsx(ae,{item:n,response:d[o]},o)),(s==null?void 0:s.orderItems.length)===0&&e.jsx("span",{children:"No items in the cart"})]})]}),e.jsx(te,{totalAmount:H(d.map(n=>n.data.product),s==null?void 0:s.orderItems),discountAmount:J(d.map(n=>n.data.product),s==null?void 0:s.orderItems),totalItems:(p=s==null?void 0:s.orderItems)==null?void 0:p.length,finalAmount:W(d.map(n=>n.data.product),s==null?void 0:s.orderItems),deliveryAddress:c,orderItems:s==null?void 0:s.orderItems,isSomeItemOutOfStock:d.some(n=>{const o=s==null?void 0:s.orderItems.find(f=>f.product===n.data.product._id),y=z(n.data.product.sizes,o==null?void 0:o.size,o==null?void 0:o.side);return(o==null?void 0:o.quantity)>y.stock})})]}):e.jsx(U,{})]})})},fe=()=>{const{state:r}=S();return r?e.jsx(ne,{}):e.jsx(T,{to:"/cart"})};export{fe as default};
