import{N as D,r as j,O as A,e as k,j as e,f as z,C as S,i as F,_ as N,R as C,S as O,s as L,A as q,m as M,L as P,P as R}from"./index-2jesu54P.js";import{a as T,h as B,b as G}from"./orders-Oz1RrtLU.js";import{c as $,d as K}from"./getPriceAfterDiscount-VCdwUlk6.js";import{u as Q}from"./useQueries-iGQQhZcA.js";import{n as V}from"./no-address-F9_hSvsD.js";import{g as Y,b as H,c as J,C as W}from"./CartPageSkeleton--2dP2Z-S.js";import{A as U}from"./AppEmpty-2_hsSmcv.js";var w=function(){return w=Object.assign||function(r){for(var t,c=1,a=arguments.length;c<a;c++){t=arguments[c];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},w.apply(this,arguments)},X=function(r,t){var c={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(c[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(r);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(r,a[s])&&(c[a[s]]=r[a[s]]);return c},Z=D("PulseLoader","0% {transform: scale(1); opacity: 1} 45% {transform: scale(0.1); opacity: 0.7} 80% {transform: scale(1); opacity: 1}","pulse");function ee(r){var t=r.loading,c=t===void 0?!0:t,a=r.color,s=a===void 0?"#000000":a,i=r.speedMultiplier,p=i===void 0?1:i,x=r.cssOverride,n=x===void 0?{}:x,m=r.size,o=m===void 0?15:m,l=r.margin,y=l===void 0?2:l,f=X(r,["loading","color","speedMultiplier","cssOverride","size","margin"]),h=w({display:"inherit"},n),v=function(b){return{backgroundColor:s,width:A(o),height:A(o),margin:A(y),borderRadius:"100%",display:"inline-block",animation:"".concat(Z," ").concat(.75/p,"s ").concat(b*.12/p,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return c?j.createElement("span",w({style:h},f),j.createElement("span",{style:v(1)}),j.createElement("span",{style:v(2)}),j.createElement("span",{style:v(3)})):null}const se=({selectedAddress:r,setSelectedAddress:t,i:c,address:a})=>{var i,p,x,n,m;const{user:s}=k(o=>o.user);return e.jsx(e.Fragment,{children:s[a]&&e.jsxs("button",{onClick:()=>t(a),className:`flex items-start justify-start text-start flex-col gap-1 border-2  py-2 px-8 rounded-lg  transition-colors ${r===a?"border-primary":"hover:border-green-200 border-gray-100"}      
          `,children:[e.jsxs("span",{className:"text-lg font-500",children:["Address ",c+1]}),e.jsx("span",{children:(i=s[a])==null?void 0:i.landmark}),e.jsx("span",{children:(p=s[a])==null?void 0:p.address}),e.jsxs("span",{children:[(x=s[a])==null?void 0:x.state,", ",(n=s[a])==null?void 0:n.city]}),e.jsx("span",{children:(m=s[a])==null?void 0:m.pin_code})]})})},re=({totalAmount:r,totalItems:t,finalAmount:c,discountAmount:a,deliveryAddress:s,orderItems:i,isSomeItemOutOfStock:p})=>{const x=z(),[n,m]=j.useState({code:"",isCouponApplied:!1}),{state:o}=S(),{user:l}=k(d=>d.user),[y,f]=j.useState(!1),h="flex justify-between text-base sm:text-lg gap-6 min-w-max w-full",{mutate:v,isPending:b,data:g}=F({mutationFn:d=>T(d),onError:d=>{N.error(d)},onSuccess:d=>{m(u=>({...u,isCouponApplied:!0})),N.success("Coupon Applied Successfully, you saved ₹"+d.discount),C.event({category:"Coupon",action:`Applied coupon ${n}`})}}),I=async()=>{var d;if(y)return N.error("Processing your request");if(p)return O.fire({icon:"error",title:"Oops...",text:"Some items are out of stock! Please remove them and try again",confirmButtonText:"Go to Cart"}).then(u=>{u.isConfirmed&&x("/cart")});if(!(l.primaryaddress||l.secondaryaddress||l.thirdaddress))return O.fire({icon:"error",title:"Oops...",text:"Please add a delivery address",confirmButtonText:"Add Address"}).then(u=>{u.isConfirmed&&x("/account?tab=addresses")});f(!0);try{localStorage.removeItem("orderDetails"),L("orderDetails",{deliveryAddress:{...l[s],phoneNo:l.phoneNo,pinCode:(d=l[s])==null?void 0:d.pin_code},orderItems:i,from:o==null?void 0:o.from,coupon:{isCouponApplied:n.isCouponApplied,code:n.code,discount:(g==null?void 0:g.discount)||0}}),C.event({category:"Checkout",action:"Clicked on Proceed to Pay"});const u=await B(),E=await G(Math.max(1,c-(n.isCouponApplied?g.discount:0)).toFixed(2)),_={key:u,amount:E.order.amount,currency:"INR",name:"Java Sports",description:"",image:"java-sports.svg",order_id:E.order.id,callback_url:q.paymentVerification,prefill:{name:l.full_name,email:l.email,contact:l.phoneNo},notes:{address:"Razorpay Corporate Office"},theme:{color:"#121212"},modal:{ondismiss:function(){localStorage.removeItem("orderDetails"),f(!1),N.error("Payment Cancelled"),C.event({category:"Checkout",action:"Payment Cancelled"})}}};new window.Razorpay(_).open()}catch{N.error("Something went wrong")}finally{f(!1)}};return e.jsxs("div",{className:"shadow-md border border-gray-200 border-opacity-40 sticky xl:top-4 rounded-md px-4 py-5 sm:p-6 bg-white h-fit flex flex-col gap-3 text-gray-700 sm:min-w-96 min-h-80 justify-center",children:[e.jsx("span",{className:"uppercase text-xl font-600 text-black",children:"Price Details"}),e.jsx("hr",{}),e.jsxs("div",{className:h,children:[e.jsxs("span",{children:["Price (",t," items)"]}),e.jsxs("span",{children:["₹",r.toFixed(2)]})]}),e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"text-green-400 text-[17px]",children:[" - ₹",a]})]}),n.isCouponApplied&&e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Coupon"}),e.jsxs("span",{className:"text-green-400 text-[17px]",children:[" ","- ₹",g.discount]})]}),e.jsxs("div",{className:h,children:[e.jsx("span",{children:"Delivery Charges"}),e.jsx("span",{className:"text-green-400 text-[17px]",children:"Free"})]}),e.jsx("hr",{}),e.jsxs("div",{className:h+" font-700",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["₹",(n.isCouponApplied?Math.max(1,c-g.discount):c).toFixed(2)]})]}),e.jsx("hr",{}),e.jsxs("span",{className:"text-sm text-grey-dark",children:["You will save ₹"," ",(a+(n.isCouponApplied?g.discount:0)).toFixed(2)," ","on this order"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("form",{onSubmit:d=>{var u;d.preventDefault(),n.code.trim()!==""&&v((u=n==null?void 0:n.code)==null?void 0:u.trim())},className:"flex flex-col xs:flex-row",children:[e.jsx("input",{className:"border rounded-t-md xs:rounded-l-md xs:rounded-tr-none py-2 flex-grow px-3 focus:outline-grey/2 text-gray-500 sm:text-lg",type:"text",placeholder:"Enter the Coupon code",value:n.code,onChange:d=>m({...n,code:d.target.value}),disabled:n.isCouponApplied||b}),e.jsx("button",{disabled:n.isCouponApplied||b||n.code.trim()==="",className:"bg-grey/1 font-500 px-6 py-1",children:n.isCouponApplied?"Applied":b?e.jsx(ee,{size:8,color:"#121212"}):"Apply"})]}),e.jsx("button",{onClick:I,className:"bg-red-500 text-lg py-2 text-white rounded-[5px] font-500",children:y?"Processing...":"Proceed to Pay"})]})]})},te=({item:r,response:t})=>{const{data:c,isLoading:a,isError:s}=t;if(a||s)return null;const i=c.product.sizes.find(p=>p.size===r.size);return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 border p-3 rounded-md w-full",children:[e.jsx("div",{className:"h-full flex items-center justify-center bg-grey/1 rounded-lg p-2 object-contain object-center w-fit group",children:e.jsx("img",{src:c.product.images[0].url,alt:c.product.name,className:"w-52 object-contain object-center"})}),e.jsxs("div",{className:"flex flex-col gap-4 relative",children:[e.jsx("h1",{className:"text-xl font-[600]",children:c.product.name}),e.jsxs("div",{className:"flex flex-col gap-1 text-base sm:text-lg",children:[e.jsxs("span",{className:"text-primary text-xs sm:text-sm font-500",children:["Special Price"," "]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("span",{className:"text-neutral-black text-xl font-500",children:["₹",($(i.basePrice,c.product.discountedPercent)*r.quantity).toFixed(2)]}),e.jsxs("span",{className:"text-[#999999] line-through",children:["₹",(Number(i.basePrice)*r.quantity).toFixed(2)]}),e.jsxs("span",{className:"text-[#00B553] font-500",children:[i.discountedPercent??0,"% off"]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex gap-2 sm:gap-6",children:[e.jsxs("div",{className:"font-[600] text-lg flex flex-col gap-2",children:[e.jsx("span",{children:"Quantity"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("span",{className:"px-4 py-1 border-2 border-[#E4E4E4] rounded-md font-500 text-black",children:r.quantity})})]}),r.size&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"h-[80%] w-[1.5px] bg-grey-light opacity-50 self-end hidden md:block"}),e.jsxs("div",{className:"flex flex-col gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-500 text-neutral-black text-lg",children:"Size"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("span",{className:"px-4 py-1 border-2 border-[#E4E4E4] rounded-md font-500 text-black",children:i.size})})]})]}),r.color&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"h-[80%] w-[1.5px] bg-grey-light opacity-50 self-end hidden md:block"}),e.jsx("hr",{className:" bg-grey-light opacity-50 md:hidden"}),e.jsxs("div",{className:"font-[600] text-lg flex flex-col gap-2",children:[e.jsx("span",{children:"Color"}),e.jsx("div",{className:"flex gap-3",children:e.jsx("span",{className:"w-8 h-8 rounded-full border-[#E4E4E4] border-[2.5px]",style:{backgroundColor:r.color}})})]})]})]})]})]})},ae=()=>{var p,x,n,m;const r=z(),{user:t}=k(o=>o.user),[c,a]=j.useState("primaryaddress"),{state:s}=S(),i=Q({queries:(p=s==null?void 0:s.orderItems)==null?void 0:p.map(o=>({queryKey:["product",o.product],queryFn:()=>K(o.product)}))});return s||r("/cart"),e.jsx("div",{className:"bg-white py-10",children:e.jsxs("section",{className:"wrapper flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-5 justify-center card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl  font-700 font-Lato",children:"Logged in as"}),e.jsx("span",{className:"text-blue font-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsx("img",{src:((x=t==null?void 0:t.avatar)==null?void 0:x.url)||M,className:"w-12 h-12 rounded-full object-cover object-center"}),e.jsx(P,{to:"/account",className:"font-500 text-xl hover:underline",children:t==null?void 0:t.full_name})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{children:["Email: ",t==null?void 0:t.email]}),e.jsxs("span",{children:["Phone: ",t==null?void 0:t.phoneNo]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 justify-center card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl font-700 font-Lato",children:"Delivery Address"}),e.jsx(P,{to:"/account?tab=addresses",className:"text-blue font-500",children:"Edit"})]}),e.jsx("div",{className:"flex gap-3 flex-col lg:flex-row",children:["primaryaddress","secondaryaddress","thirdaddress"].map((o,l)=>e.jsx(se,{selectedAddress:c,setSelectedAddress:a,address:o,i:l},l))}),!(t.primaryaddress||t.secondaryaddress||t.thirdaddress)&&e.jsx(U,{btnText:"Add Address",text:"You have not added any address",to:"/account?tab=addresses",img:V})]}),i.every(o=>o.isSuccess)?e.jsxs("div",{className:"flex gap-6 flex-col xl:flex-row",children:[e.jsxs("div",{className:"flex flex-col flex-grow gap-4 card-shadow p-6 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xl sm:text-3xl font-700 font-Lato",children:"Order Summery"}),(s==null?void 0:s.from)&&(s==null?void 0:s.from)!=="reorder"&&e.jsx(P,{to:s!=null&&s.from&&(s==null?void 0:s.from)==="product"?`/product/${(n=s==null?void 0:s.orderItems[0])==null?void 0:n.id}`:"/cart",className:"text-blue font-500 text-lg",children:"Edit"})]}),e.jsxs("div",{className:"flex gap-5 flex-col",children:[s==null?void 0:s.orderItems.map((o,l)=>e.jsx(te,{item:o,response:i[l]},l)),(s==null?void 0:s.orderItems.length)===0&&e.jsx("span",{children:"No items in the cart"})]})]}),e.jsx(re,{totalAmount:Y(i.map(o=>o.data.product),s==null?void 0:s.orderItems),discountAmount:H(i.map(o=>o.data.product),s==null?void 0:s.orderItems),totalItems:(m=s==null?void 0:s.orderItems)==null?void 0:m.length,finalAmount:J(i.map(o=>o.data.product),s==null?void 0:s.orderItems),deliveryAddress:c,orderItems:s==null?void 0:s.orderItems,isSomeItemOutOfStock:i.some(o=>{const l=s==null?void 0:s.orderItems.find(f=>f.product===o.data.product._id),y=o.data.product.sizes.find(f=>f.size===(l==null?void 0:l.size));return(l==null?void 0:l.quantity)>y.stock})})]}):e.jsx(W,{})]})})},me=()=>{const{state:r}=S();return r?e.jsx(ae,{}):e.jsx(R,{to:"/cart"})};export{me as default};
